/* Sparkart.js v0.1.0
   Generated on 2013-03-15 at 11:56:58 */

this.sparkart={},function(e,s){s.registerHelper("birthdate_selector",function(){var e='<select name="birth_month">';for(var s in a)e+='<option value="'+(parseInt(s)+1)+'">'+a[s]+"</option>";e+="</select>";for(var t='<select name="birth_day">',r=1;31>=r;)t+='<option value="'+r+'">'+r+"</option>",r++;t+="</select>";for(var i='<select name="birth_year">',n=(new Date).getFullYear(),o=n-115;n>=o;)i+=o===n-18?'<option value="'+o+'" selected="selected">'+o+"</option>":'<option value="'+o+'">'+o+"</option>",o++;return i+="</select>",e+t+i});var t="https://services.sparkart.net/api/v1/consumer",a=["January","February","March","April","May","June","July","August","September","October","November","December"],r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],i=function(e){if(!e)return null;var s=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})([-\+][0-9]{4})/,t=s.exec(e),i=t[1],n=parseInt(t[2],10),o=parseInt(t[3],10),l=new Date(n+"-"+o+"-"+i).getDay(),d=parseInt(t[4],10),u=t[5],c=t[6];t[7];var p={year:{full:i,half:i.substr(2)},month:{number:n,text:a[n-1],abbr:a[n-1].substr(0,3)},day:{number:o,text:r[l],abbr:r[l].substr(0,3)},hour:{half:d%12||12,full:d},minute:u,second:c,ampm:d/12>1?"AM":"PM",original:e};return p},n=function(e){var s=encodeURIComponent(e.address+" "+e.city+", "+e.state+" "+e.postalcode+", "+e.country);return e.directions={google_maps:"https://www.google.com/maps?q="+s,yahoo_maps:"http://maps.yahoo.com/maps_result?addr="+s,mapquest:"http://www.mapquest.com/?q="+s,bing_maps:"http://www.bing.com/maps/?q="+s},e},o=sparkart.Fanclub=function(a,r){var o=this;o._listeners={},o.key=a,r=r||{},"boolean"==typeof r.reload&&(r.reload={login:r.reload,logout:r.reload,register:r.reload,password_reset:r.password_reset});var l={reload:{login:!0,logout:!0,register:!0,password_reset:!0},redirect:{},api_url:t};o.parameters=e.extend(l,r);var d=o.preprocessors={event:[function(e){return e.event.date=i(e.event.date),e.event.doors_open=i(e.event.doors_open),e.event.start=i(e.event.start),e.event.venue=n(e.event.venue),e}],events:[function(s){return e(s.events).each(function(e,s){s.date=i(s.date),s.doors_open=i(s.doors_open),s.start=i(s.start),s.venue=n(s.venue)}),s}],register:[function(e){return e.customer&&(null===e.customer.username?e.customer.username_required=!0:e.customer.username_required===!1),e}]};if(r.templates)for(var u in r.templates)r.templates[u]=r.templates[u];var c=o.templates=e.extend(sparkart.Fanclub.templates,r.templates);for(var p in c)c[p]=s.compile(c[p]);if(r.preprocessors)for(var a in r.preprocessors){var m=r.preprocessors[a];d[a]||(d[a]=[]),"function"==typeof m?d[a].push(m):d[a].concat(m)}o.get("account",function(e,s){o.get("fanclub",function(e,t){o.customer=s?s.customer:null,o.authentications=t?t.fanclub.authentications:null,o.name=t?t.fanclub.name:null,o.draw(function(){o.trigger("load"),o.loaded=!0})})})};o.prototype.register=function(e,s){var t=this;e=e||{},this.post("account/register",e,function(a,r){if(a)return s&&s(a),void 0;s&&s(null,r),t.trigger("register",r.customer),t.customer=r.customer;var i=t.parameters.redirect.register||e.redirect;i?window.location=i:t.parameters.reload.register&&location.reload()})},o.prototype.login=function(e,s){var t=this;e=e||{},this.post("login",e,function(a,r){if(a)return s&&s(a),void 0;s&&s(null,r),t.trigger("login",r.customer),t.customer=r.customer;var i=t.parameters.redirect.login||e.redirect;i?window.location=i:t.parameters.reload.login&&location.reload(),t.parameters.reload.login||t.draw()})},o.prototype.logout=function(e,s){var t=this;e=e||{},this.post("logout",e,function(a,r){if(a)return s&&s(a),void 0;s&&s(null,r),t.trigger("logout"),delete t.customer;var i=t.parameters.redirect.logout||e.redirect;i?window.location=i:t.parameters.reload.logout?location.reload():t.draw()})},o.prototype.draw=function(){var s,t,a,r=this;for(var i in arguments)"string"==typeof arguments[i]||arguments[i]instanceof e&&!s?s=arguments[i]:"[object Object]"!==Object.prototype.toString.call(arguments[i])||t?"function"!=typeof arguments[i]||a||(a=arguments[i]):t=arguments[i];if(!s){var n=e(".sparkart.fanclub"),o=0;return n.each(function(s,i){r.draw(e(i),t,function(){o++,o===n.length&&a&&a()})}),void 0}s=e(s);var l=s.data();t=t||{},t=e.extend(t,l);var d;s.is(".subscriptions")?d="subscriptions":s.is(".plans")?d="plans":s.is(".events")?d="events":s.is(".event")?d="event":s.is(".receipt")?d="receipt":s.is(".login")?d="login":s.is(".logout")?d="logout":s.is(".register")?d="register":s.is(".account")?d="account":s.is(".customer")?d="customer":s.is(".password_reset")?d="password_reset":s.is(".order")?d="order":s.is(".orders")?d="orders":s.is(".affiliates")&&(d="affiliates"),s.removeClass("error").addClass("loading"),this.bindWidget(d,s),this.renderWidget(d,t,function(e,t){return e?(s.removeClass("loading").addClass("error"),a&&a(e),void 0):(s.html(t).removeClass("loading"),a&&a(null,s),r.trigger("render",s),void 0)})},o.prototype.renderWidget=function(s,t,a){var r=this;if("login"===s||"logout"===s||"register"===s||"customer"===s)this.get("account",function(i,n){i&&(n={}),n.parameters=t;var o=r.preprocessors[s];o&&e(o).each(function(e,s){n=s(n)}),"register"===s&&(n.terms_url=r.parameters.api_url+"/terms?key="+r.key);var l=r.templates[s](n);a&&a(null,l)});else if("password_reset"===s){var i=r.templates[s]({token:!0});a&&a(null,i)}else this.get(s,t,function(i,n){if(i)return a(i);n.parameters=t;var o=r.preprocessors[s];o&&e(o).each(function(e,s){n=s(n)}),a&&a(null,r.templates[s](n))})},o.prototype.request=function(s,t,a,r){var i="json";a=e.extend({},a),a.key=this.key,"undefined"!=typeof XDomainRequest&&(a._method=t,t="GET",i="jsonp"),a.id&&delete a.id;var n=e.ajax({url:s,type:t,crossDomain:!0,xhrFields:{withCredentials:!0},dataType:i,data:a});return n.done(function(e){r&&("error"===e.status?r(e.messages):r(null,e))}).fail(function(e){try{var s=JSON.parse(e.responseText)}catch(t){console.error(t)}var a=s?s.messages:[];r&&r(a)}),n},o.prototype.get=function(e,s,t){t===void 0&&"function"==typeof s&&(t=s,s=null);var a=this;s=s||{},("event"===e||"plan"===e||"order"===e)&&(e+="s");var r=s.id?a.parameters.api_url+"/"+e+"/"+s.id+".json":a.parameters.api_url+"/"+e+".json";return this.request(r,"GET",s,t)},o.prototype.post=function(e,s,t){t===void 0&&"function"==typeof s&&(t=s,s=null);var a=this,r=a.parameters.api_url+"/"+e+".json";return this.request(r,"POST",s,t)},o.prototype.bindWidget=function(s,t){var a=this,r=t.data();"login"===s?(t.off(".sparkart").on("submit.sparkart","form.login",function(s){s.preventDefault();var t=e(this);r=e.extend(r,{email:t.find('input[name="email"]').val(),password:t.find('input[name="password"]').val()}),t.removeClass("error success").find("div.errors, div.success").hide();var i=t.find('button[type="submit"]');i.prop("disabled",!0),a.login(r,function(s){i.prop("disabled",!1);var r=t.find("div.errors");if(r.empty().hide(),s){t.addClass("error");var n=e(a.templates.errors({errors:s}));return r.html(n).show(),void 0}t.addClass("success");var o=t.find("div.success");o.show()})}),t.on("click.sparkart",'a[href="#forgot"]',function(s){s.preventDefault();var t=e(this),a=t.closest(".sparkart.fanclub.login"),r=a.find("form.forgot");r.show()}).on("click.sparkart",'a[href="#close"]',function(s){s.preventDefault();var t=e(this),a=t.closest("form.forgot");a.hide()}).on("submit.sparkart","form.forgot",function(s){s.preventDefault();var t=e(this);r=e.extend(r,{email:t.find('input[name="email"]').val()}),t.removeClass("error success").find("div.errors, div.success").hide();var i=t.find('button[type="submit"]');i.prop("disabled",!0),a.post("password_reset",r,function(s){i.prop("disabled",!1);var r=t.find("div.errors");if(r.empty().hide(),s){t.addClass("error");var n=e(a.templates.errors({errors:s}));return r.html(n).show(),void 0}t.addClass("success");var o=t.find("div.success");o.show()})})):"logout"===s?t.off(".sparkart").on("click.sparkart",'a[href="#logout"]',function(e){e.preventDefault(),a.logout(r,function(e){return e?console.log(e):void 0})}):"register"===s?t.off(".sparkart").on("submit.sparkart",function(s){s.preventDefault();var t=e(this),i=t.find('select[name="birth_day"]'),n=t.find('select[name="birth_month"]'),o=t.find('select[name="birth_year"]'),l=i.val()+"-"+n.val()+"-"+o.val();r=e.extend(r,{username:t.find('input[name="username"]').val(),first_name:t.find('input[name="first_name"]').val(),last_name:t.find('input[name="last_name"]').val(),username:t.find('input[name="username"]').val(),birthdate:l,email:t.find('input[name="email"]').val(),password:t.find('input[name="password"]').val(),password_confirmation:t.find('input[name="password_confirmation"]').val(),accept_terms:t.find('input[name="accept_terms"]').prop("checked")}),t.removeClass("error success").find("div.errors, div.success").hide();var d=t.find('button[type="submit"]');d.prop("disabled",!0),a.register(r,function(s){d.prop("disabled",!1);var r=t.find("div.errors");if(r.empty().hide(),s){t.addClass("error");var i=e(a.templates.errors({errors:s}));return r.html(i).show(),void 0}t.addClass("success");var n=t.find("div.success");n.show()})}):"account"===s?t.off(".sparkart").on("submit.sparkart",function(s){s.preventDefault();var t=e(this);r=e.extend(r,{username:t.find('input[name="username"]').val(),first_name:t.find('input[name="first_name"]').val(),last_name:t.find('input[name="last_name"]').val(),email:t.find('input[name="email"]').val(),current_password:t.find('input[name="current_password"]').val(),password:t.find('input[name="password"]').val(),password_confirmation:t.find('input[name="password_confirmation"]').val()}),t.removeClass("error success").find("div.errors, div.success").hide();var i=t.find('button[type="submit"]');i.prop("disabled",!0),a.post("account",r,function(s){i.prop("disabled",!1);var r=t.find("div.errors");if(r.empty().hide(),s){t.addClass("error");var n=e(a.templates.errors({errors:s}));return r.html(n).show(),void 0}t.addClass("success");var o=t.find("div.success");o.show()})}):"password_reset"===s&&t.off(".sparkart").on("submit.sparkart",function(s){s.preventDefault();var t=e(this);r=e.extend(r,{password:t.find('input[name="password"]').val(),password_confirmation:t.find('input[name="password_confirmation"]').val()});for(var i=location.search.substr(1).split("&"),n={},o=i.length-1;o>=0;o--){var l=i[o].split("="),d=l[0],u=l[1];n[d]=u}t.removeClass("error success").find("div.errors, div.success").hide();var c=t.find('button[type="submit"]');c.prop("disabled",!0),a.post("password_reset/"+n.token,r,function(s){c.prop("disabled",!1);var i=t.find("div.errors");if(i.empty().hide(),s){t.addClass("error");var n=e(a.templates.errors({errors:s}));return i.html(n).show(),void 0}t.addClass("success");var o=t.find("div.success");o.show();var l=a.parameters.redirect.password_reset||r.redirect;l&&(window.location=l)})})},o.prototype.on=function(e,s){var t=this;this._listeners[e]===void 0&&(this._listeners[e]=[]),"function"==typeof s&&(this._listeners[e].push(s),"load"===e&&t.loaded&&s())},o.prototype.trigger=function(s){var t=Array.prototype.splice.call(arguments,1);if(this._listeners[s]instanceof Array){var a=this._listeners[s];e(a).each(function(e,s){s.apply(this,t)})}},o.prototype.off=function(e,s){if(e||s||(this._listeners={}),this._listeners[e]instanceof Array){var t=this._listeners[e];if(s)for(var a=0;t.length>a;a++){var r=t[a];if(r===s){t.splice(a,1);break}}else t.splice(0,t.length)}},o.prototype.destroy=function(){this.off(),e(".sparkart.fanclub").off(".sparkart").empty()}}(jQuery,Handlebars),this.sparkart.Fanclub.templates={account:'{{#customer}}{{#registered}}<form class="account">	<div class="success" style="display: none;">		<p>Account Successfully Updated!</p>	</div>	<div class="errors" style="display: none;"></div>	<fieldset>		<label>Username<br />		<input name="username" type="text" value="{{username}}" /></label><br />		<label>First Name<br />		<input name="first_name" type="text" value="{{first_name}}" /></label><br />		<label>Last Name<br />		<input name="last_name" type="text" value="{{last_name}}" /></label><br />		<label>Email Address<br />		<input name="email" type="text" value="{{email}}" /></label><br />		<div class="password">			<label>Current Password<br />			<input name="current_password" type="password" /></label>			<hr />			<label>New Password<br />			<input name="password" type="password" /></label><br />			<label>Repeat New Password<br />			<input name="password_confirmation" type="password" /></label>		</div>	</fieldset>	<button type="submit">Update Account</button></form>{{/registered}}{{/customer}}',affiliates:'{{#affiliates}}	<h2>{{name}}</h2>	<ul class="codes">		{{#codes}}<li>{{.}}</li>{{/codes}}	</ul>{{/affiliates}}',customer:'{{#customer}}{{#registered}}<div class="info">	{{#if username}}	<strong class="username">{{username}}</strong>	{{else}}	<strong class="name">{{first_name}} {{last_name}}</strong>	{{/if}}	{{#subscription}}	<span class="subscription">{{plan.name}}</span>	{{/subscription}}</div>{{/registered}}{{/customer}}',errors:'<ul class="errors">{{#errors}}<li>{{.}}</li>{{/errors}}</ul>',event:'{{#event}}<div class="event">	<h2>{{date.month.abbr}} {{date.day.number}}</h2>	<h3>{{title}}</h3>	<div class="description">{{description}}</div>	<dl>		{{#doors_open}}		<dt>Doors Open</dt>		<dd>{{hour.half}}:{{minute}} <span class="ampm">{{ampm}}</span></dd>		{{/doors_open}}		{{#start}}		<dt>Start</dt>		<dd>{{hour.half}}:{{minute}} <span class="ampm">{{ampm}}</span></dd>		{{/start}}	</dl>	{{#venue}}	<div class="venue">		<h4>{{name}}</h4>		<strong class="city">{{city}}</strong>, <em class="state">{{state}}</em> <span class="country">{{country}}</span>		<h5>Directions</h5>		<ul class="directions">			{{#directions}}			<li><a href="{{google_maps}}">Google Maps</a></li>			<li><a href="{{yahoo_maps}}">Yahoo Maps</a></li>			<li><a href="{{mapquest}}">Mapquest</a></li>			<li><a href="{{bing_maps}}">Bing Maps</a></li>			{{/directions}}		</ul>	</div>	{{/venue}}	<ul class="links">		{{#links}}		<li><a href="{{url}}">{{name}}</a></li>		{{/links}}	</ul></div>{{/event}}',events:'<ul class="events">	{{#events}}	<li>		<h2><a href="{{../parameters.url}}{{id}}">{{date.month.abbr}} {{date.day.number}}</a></h2>		<h3>{{title}}</h3>		<div class="description">{{description}}</div>		{{#venue}}		<div class="venue">			<h4>{{name}}</h4>			<strong>{{city}}</strong>, {{state}}		</div>		{{/venue}}		<ul class="links">			{{#links}}			<li><a href="{{url}}">{{name}}</a></li>			{{/links}}		</ul>	</li>	{{/events}}</ul>',login:'{{^customer}}<form class="login">	<div class="success" style="display: none;">		<p>You have successfully logged in.</p>	</div>	<div class="errors" style="display: none;"></div>	<fieldset>		<label>Email<br />		<input name="email" type="text" /></label>		<label>Password<br />		<input name="password" type="password" /></label>		<a href="#forgot">Forgot Password?</a>	</fieldset>	<button type="submit">Log In</button></form><form class="forgot" style="display:none">	<a href="#close">Close</a>	<div class="success" style="display: none;">		<p>A message has been sent to this address. Please check your email for instructions on how to reset your password.</p>	</div>	<div class="errors" style="display: none;"></div>	<fieldset>		<p>Please enter the email address you used for your fanclub account:</p>		<label>Email<br />		<input type="text" name="email"></input>	</fieldset>	<button type="submit">Submit</button></form>{{/customer}}',logout:'{{#customer}}<a href="#logout">Log Out</a>{{/customer}}',order:'{{#order}}<div class="order">	<h4>Order {{id}}</h4>	<div class="details">		<h5 class="name">{{plan.name}}</h5>		<span class="customer">Customer ID: <var>{{customer_id}}</var></span>		<ul class="dates">			{{#paid_at}}			<li class="paid">Paid <var class="date">{{.}}</var></li>			{{/paid_at}}			{{#refunded_at}}			<li class="refunded">Refunded <var class="refunded">{{.}}</var></li>			{{/refunded_at}}		</ul>	</div>	{{#billing_address}}	<div class="billing">		<h6>Billed To</h6>		<ul class="address">			<li class="name">{{first_name}} {{last_name}}</li>			<li class="country">{{country}}</li>			<li class="address line1">{{address}}</li>			<li class="address line2">{{city}}, {{state}}, {{postal_code}}</li>		</ul>	</div>	{{/billing_address}}	<ul class="shipments">	{{#shipments}}		<li>			{{#tracking_number}}<var class="tracking">{{.}}</var>{{/tracking_number}}			<div class="shipping">				<h6>Shipped To</h6>				{{#shipping_address}}				<ul class="address">					<li class="name">{{first_name}} {{last_name}}</li>					<li class="address line1">{{address}}</li>					<li class="address line2">{{city}}, {{state}}, {{postal_code}}, {{country}}</li>				</ul>				{{/shipping_address}}			</div>			{{#ship_date}}<span class="shipped">Shipped On <var class="date">{{.}}</var></span>{{/ship_date}}			<ul class="items">			{{#items}}				<li>					{{#thumbnail}}<img class="thumbnail" src="{{.}}" />{{/thumbnail}}					<strong class="name">{{name}}</strong>					{{#option}}<span class="option">{{.}}</span>{{/option}}				</li>			{{/items}}			</ul>		</li>	{{/shipments}}	</ul>	{{#totals}}	<dl class="totals">		<dt class="subtotal">Subtotal</dt>		<dd class="subtotal">${{subtotal}}</dd>		{{#shipping}}		<dt class="shipping">Shipping</dt>		<dd class="shipping">${{.}}</dd>		{{/shipping}}		{{#discount}}		<dt class="discount">Discount</dt>		<dd class="discount">${{.}}</dd>		{{/discount}}		<dt class="total">Total</dt>		<dd class="total">${{total}}</dd>	</dl>	{{/totals}}</div>{{/order}}',orders:'<ul class="orders">	{{#orders}}	<li>		<a href="{{../parameters.url}}{{id}}"><h4>Order {{id}}</h4></a>		<div class="details">			<h5 class="name">{{plan.name}}</h5>			<span class="customer">Customer ID: <var>{{customer_id}}</var></span>			<ul class="dates">				{{#paid_at}}				<li class="paid">Paid <var class="date">{{.}}</var></li>				{{/paid_at}}				{{#refunded_at}}				<li class="refunded">Refunded <var class="refunded">{{.}}</var></li>				{{/refunded_at}}			</ul>		</div>		{{#totals}}		<dl class="totals">			<dt class="subtotal">Subtotal</dt>			<dd class="subtotal">${{subtotal}}</dd>			{{#shipping}}			<dt class="shipping">Shipping</dt>			<dd class="shipping">${{.}}</dd>			{{/shipping}}			{{#discount}}			<dt class="discount">Discount</dt>			<dd class="discount">${{.}}</dd>			{{/discount}}			<dt class="total">Total</dt>			<dd class="total">${{total}}</dd>		</dl>		{{/totals}}	</li>	{{/orders}}</ul>',password_reset:'{{#token}}<form class="password_reset">	<div class="success" style="display: none;">		<p>Password Successfully Updated!</p>	</div>	<div class="errors" style="display: none;"></div>	<fieldset>		<div class="password">			<label>New Password<br />			<input name="password" type="password" /></label><br />			<label>Repeat New Password<br />			<input name="password_confirmation" type="password" /></label>		</div>	</fieldset>	<button type="submit">Update Password</button></form>{{/token}}',plan:'<div class="plan">	<h2>{{name}}</h2>	<h3>{{price}}</h3>	<div class="description">{{description}}</div>	{{#package}}		<h3>{{name}}</h3>		<ul class="items">			{{#items}}			<li>				<img src="{{thumbnail}}" />				<strong>{{name}}</strong>			</li>			{{/items}}		</ul>	{{/package}}	<ul class="actions">		<li class="join"><a href="{{checkout}}">Join Now</a></li>	</ul>	{{#annotations}}<sub class="annotations">{{.}}</sub>{{/annotations}}	</div>',plans:'<ul class="plans">	{{#plans}}	<li>		<h2>{{name}}</h2>		<h3>{{price}}</h3>		<div class="description">{{description}}</div>		{{#package}}			<h3>{{name}}</h3>			<ul class="items">				{{#items}}				<li>					<img src="{{thumbnail}}" />					<strong>{{name}}</strong>				</li>				{{/items}}			</ul>		{{/package}}		<ul class="actions">			<li class="join"><a href="{{checkout}}">Join Now</a></li>		</ul>		{{#annotations}}<sub class="annotations">{{.}}</sub>{{/annotations}}	</li>	{{/plans}}</ul>',receipt:'<ul class="receipt">{{#items}}<li>{{name}}</li>{{/items}}</ul>',register:'{{#customer}}{{^registered}}<form class="register" method="PUT">	<div class="success" style="display: none;">		<p>You have successfully completed the registration of your fanclub account.</p>	</div>	<div class="errors" style="display: none;"></div>	<fieldset>		<p>Complete your fanclub account registration.</p>		{{^email}}		<label>Email<br />		<input name="email" type="text" /></label>		{{/email}}		{{#username_required}}		<label>Username<br />		<input name="username" type="text" /></label><br />		{{/username_required}}		{{^first_name}}		<label>First Name<br />		<input name="first_name" type="text" /></label>		{{/first_name}}		{{^last_name}}		<label>Last Name<br />		<input name="last_name" type="text" /></label>		{{/last_name}}		{{^birthdate}}		<label>Date of Birth</label>		{{{birthdate_selector}}		{{/birthdate}}		<label>Password<br />		<input name="password" type="password" /></label>		<label>Password Confirm<br />		<input name="password_confirmation" type="password" /></label>		<label><input name="accept_terms" type="checkbox" /> I agree to the fanclub <a href="{{terms_url}}" target="_blank">Terms and Conditions</a></label>	</fieldset>	<button type="submit">Register</button></form>{{/registered}}{{/customer}}',subscription:'<div class="subscription">{{name}}</div>',subscriptions:'<ul class="subscriptions">	{{#subscriptions}}	<li>{{name}}</li>	{{/subscriptions}}</ul>'};